<HTML>
<HEAD>
<TITLE>C<CGI::Explorer> - A class to manage a tree of data, for use in CGI scripts</TITLE>
<LINK REV="made" HREF="mailto:">
</HEAD>

<BODY>

<A NAME="__index__"></A>
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A></LI>
	<LI><A HREF="#version">VERSION</A></LI>
	<LI><A HREF="#synopsis">SYNOPSIS</A></LI>
	<LI><A HREF="#description">DESCRIPTION</A></LI>
	<LI><A HREF="#overview">Overview</A></LI>
	<LI><A HREF="#constructor and initialization">Constructor and initialization</A></LI>
	<LI><A HREF="#icons for nodes">Icons for Nodes</A></LI>
	<LI><A HREF="#as_html($q)"><CODE>as_HTML($q)</CODE></A></LI>
	<LI><A HREF="#_build_result(...)"><CODE>_build_result(...)</CODE></A></LI>
	<LI><A HREF="#css([$new_css])"><CODE>css([$new_css])</CODE></A></LI>
	<LI><A HREF="#current_id()"><CODE>current_id()</CODE></A></LI>
	<LI><A HREF="#depth($id)"><CODE>depth($id)</CODE></A></LI>
	<LI><A HREF="#_depth()"><CODE>_depth()</CODE></A></LI>
	<LI><A HREF="#_found()"><CODE>_found()</CODE></A></LI>
	<LI><A HREF="#from_dir($dir_name)"><CODE>from_dir($dir_name)</CODE></A></LI>
	<LI><A HREF="#from_hash($hash_ref)"><CODE>from_hash($hash_ref)</CODE></A></LI>
	<LI><A HREF="#get($option)"><CODE>get($option)</CODE></A></LI>
	<LI><A HREF="#image($icon_id, $new_image)">image($icon_id, $new_image)</A></LI>
	<LI><A HREF="#name()"><CODE>name()</CODE></A></LI>
	<LI><A HREF="#parent_id()"><CODE>parent_id()</CODE></A></LI>
	<LI><A HREF="#set()"><CODE>set()</CODE></A></LI>
	<LI><A HREF="#state($q)"><CODE>state($q)</CODE></A></LI>
	<LI><A HREF="#required modules">Required Modules</A></LI>
	<LI><A HREF="#changes">Changes</A></LI>
	<LI><A HREF="#author">AUTHOR</A></LI>
	<LI><A HREF="#copyright">COPYRIGHT</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="name">NAME</A></H1>
<P><CODE>CGI::Explorer</CODE> - A class to manage a tree of data, for use in CGI scripts</P>
<P>
<HR>
<H1><A NAME="version">VERSION</A></H1>
<P>This document refers to version 1.12 of <CODE>CGI::Explorer</CODE>, released 23-Mar-2001.</P>
<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS</A></H1>
<P>This is tested code, altho the she-bang (#!) line must start in column 1:</P>
<PRE>
        #!/usr/Bin/Perl</PRE>
<PRE>
        use strict;
        use warnings;</PRE>
<PRE>
        use CGI;
        use CGI::Explorer;</PRE>
<PRE>
        my($q)          = CGI -&gt; new();
        my($tree)       = CGI::Explorer -&gt; new();
        my($dir)        = 'D:/My Documents/HomePage';</PRE>
<PRE>
        $tree -&gt; from_dir($dir);</PRE>
<PRE>
        my($state)      = $tree -&gt; state($q); # Must follow from_dir() or from_hash().
        my($tree_set)   = $tree -&gt; as_HTML($q);
        my($result_set) = 'Id: ' . $tree -&gt; current_id() . '. Name: ' . $tree -&gt; name();</PRE>
<PRE>
        print   $q -&gt; header(),
                        $q -&gt; start_html(),
                        $tree -&gt; css(),
                        $q -&gt; start_form({action =&gt; $q -&gt; url()}),
                        $q -&gt; hidden({name =&gt; 'explorer_state', value =&gt; $state, force =&gt; 1}),
                        $q -&gt; table
                        (
                                {border =&gt; 1},
                                $q -&gt; Tr
                                ([
                                        $q -&gt; td($tree_set) .
                                        $q -&gt; td($result_set),
                                ])
                        ),
                        $q -&gt; end_form(),
                        $q -&gt; end_html();</PRE>
<P>You need only change 2 lines at most, after cutting and pasting it:</P>
<UL>
<LI>
#!/usr/Bin/Perl
<P></P>
<LI>
<CODE>my($dir)</CODE> = 'D:/My Documents/HomePage';
<P></P></UL>
<P>
<HR>
<H1><A NAME="description">DESCRIPTION</A></H1>
<P><CODE>CGI::Explorer</CODE> is a support module for CGI scripts. It manages a tree of data, so
that the script can display the tree, and the user can click on <STRONG>the icon</STRONG> of a node
in the tree to open or close that node.</P>
<P>Opening a node reveals all children of that node, and restores their open/closed state.</P>
<P>Closing a node hides all children of that node.</P>
<P>Even when using the <STRONG>new</STRONG>(click_text =&gt; 1), clicking on <STRONG>the text</STRONG> of a node does
not toggle the open/closed status of a node.</P>
<P>
<HR>
<H1><A NAME="overview">Overview</A></H1>
<P><CODE>CGI::Explorer</CODE> reconstructs its internal representation of the tree each time the script
is invoked.</P>
<P>Some of data comes from the script calling <STRONG>from_dir()</STRONG> or
<STRONG>from_hash()</STRONG>, and some of the data comes from CGI form fields returned
from the previous invocation of the script.</P>
<P>Specifically, the open/closed state of each node is sent on a round trip from one
invocation of the script out to the browser, and, via a 'form submit', back to the
next invocation of the script.</P>
<P>Also, clicking on a node on a form submits the form, and passed the id of the node
so clicked back to the second invocation of the script. When using the <STRONG>new()</STRONG> option
click_text =&gt; 1, clicking on the text of the node also submits the form.</P>
<P>State maintenance - a complex issue - is discussed further below. See the 'state'
method.</P>
<P>
<HR>
<H1><A NAME="constructor and initialization">Constructor and initialization</A></H1>
<P><CODE>new(...)</CODE> returns a <CODE>CGI::Explorer</CODE> object.</P>
<P>This is the class's contructor.</P>
<P>A call to <STRONG>new()</STRONG> is equivalent to:</P>
<P>new(click_text =&gt; 0, css =&gt; '...', image_dir =&gt; '/images', show_current =&gt; 1,
show_id =&gt; 1, show_name =&gt; 1, sort_by =&gt; 'name')</P>
<P>Options:</P>
<UL>
<LI>
click_text - Default is 1
<P>Make the displayed text (id and/or name) of the node a submit button.</P>
<P></P>
<LI>
css - Default is &lt;a very long string&gt;. See source code for gory details
<P>Provide a style-sheet for submit buttons, for use when click_text == 1.</P>
<P>A default style-sheet is provided. Yes, I know the submit button text,
using the style-sheet, is really too wide, but as you'll see from the source,
I cannot find a style-sheet command to make it narrower.</P>
<P></P>
<LI>
css_background - Default is 'white'
<P>The background color for submit buttons.</P>
<P></P>
<LI>
css_color - Default is 'navy'
<P>The foreground color for submit buttons.</P>
<P></P>
<LI>
image_dir - Default is '/images'
<P>Specify the web server's directory in which the node icons are to be found.</P>
<P>Note: This is <STRONG>not</STRONG> the operating system path of the directory, it is the path
relative to the web server's document root.</P>
<P></P>
<LI>
show_current - Default is 1
<P>Show a special icon for the 'current' node.</P>
<P></P>
<LI>
show_id - Default is 1
<P>Show the id of the node, to the right of the node's icon.</P>
<P></P>
<LI>
show_name - Default is 1
<P>Show the name of the node, to the right of the node's icon, and to the right of the
node's id (if show_id == 1).</P>
<P>If show_id == 0 &amp;&amp; show_name == 0, nothing is displayed.</P>
<P></P>
<LI>
sort_by - Default is 'name'
<P>When set to 'name' (any case), sort the nodes by their names. When set to 'id', sort
them by their ids. Sorting applies to all nodes at the same depth.</P>
<P></P></UL>
<P>
<HR>
<H1><A NAME="icons for nodes">Icons for Nodes</A></H1>
<P><CODE>CGI::Explorer</CODE> ships with a set of icons, with a PNG and a GIF for each icon.</P>
<P>The default is GIF, because more browsers support GIF transparency than support
PNG transparency.</P>
<P>You don't have to pay UniSys a licence for usage of the GIF compression algorithm,
because the GIFs are uncompressed :-).</P>
<P>The make file does not install these files automatically. You must install them
manually under the web server's document root, and then use the image_dir option
to point to the directory containing these files.</P>
<P>Many GIFs are from a package called MySQLTool. Unfortunately the authors of this
program have forgotten to put a download URI in their package. You may get some joy
here: <A HREF="http://lists.dajoba.com/m/listinfo/mysqltool.">http://lists.dajoba.com/m/listinfo/mysqltool.</A></P>
<P>I've renamed their files from the names used by MySQLTool.</P>
<P>The icons for the root node, and for the current node, are not quite satisfactory.
Let me know if you have better ones available.</P>
<P>If the transparent PNG does not display properly on your browser, which is likely,
update the browser, or try using the GIFs.</P>
<P>Almost all icons are constrained to a size of 17 x 17. The exception is the icon
for the root, which is unconstrained, so that you may use any image you wish.</P>
<P>Use the method <STRONG>image($icon_id, $image_name)</STRONG> to change the image file name of an icon.</P>
<P>
<HR>
<H1><A NAME="as_html($q)"><CODE>as_HTML($q)</CODE></A></H1>
<P>Returns a string.</P>
<P>Converts the internal representation of the data into HTML, and returns that.</P>
<P>
<HR>
<H1><A NAME="_build_result(...)"><CODE>_build_result(...)</CODE></A></H1>
<P>Used internally.</P>
<P>
<HR>
<H1><A NAME="css([$new_css])"><CODE>css([$new_css])</CODE></A></H1>
<P>Returns a string of HTML containing a style-sheet for submit buttons.</P>
<P>Can be used to set the style-sheet, like <STRONG>set</STRONG>(css =&gt; $new_css).</P>
<P>See ce.cgi for an example.</P>
<P>
<HR>
<H1><A NAME="current_id()"><CODE>current_id()</CODE></A></H1>
<P>Returns the id of the 'current' node.</P>
<P>
<HR>
<H1><A NAME="depth($id)"><CODE>depth($id)</CODE></A></H1>
<P>Returns the depth of the node whose id is given, or 0.</P>
<P>
<HR>
<H1><A NAME="_depth()"><CODE>_depth()</CODE></A></H1>
<P>Used internally.</P>
<P>Called by <STRONG>depth()</STRONG> via Tree::Nary::traverse.</P>
<P>
<HR>
<H1><A NAME="_found()"><CODE>_found()</CODE></A></H1>
<P>Used internally.</P>
<P>Called by File::Find, which means it does not receive $self as its first parameter,
which means in turn that it must use the class global $myself to access class data.</P>
<P>
<HR>
<H1><A NAME="from_dir($dir_name)"><CODE>from_dir($dir_name)</CODE></A></H1>
<P>Returns nothing.</P>
<P>Tells the object to construct its internal representation of the data by parsing
the names of all sub-directories in the given directory.</P>
<P>Usage:</P>
<UL>
<LI>
$tree -&gt; from_dir('/home/rons');
<P></P>
<LI>
$tree -&gt; from_dir('D:\My Documents');
<P></P>
<LI>
$tree -&gt; from_dir('D:/My Documents');
<P></P></UL>
<P>You call <STRONG>as_HTML($q)</STRONG> later to retrieve a printable version of the data.</P>
<P>See ce.cgi for an example.</P>
<P>
<HR>
<H1><A NAME="from_hash($hash_ref)"><CODE>from_hash($hash_ref)</CODE></A></H1>
<P>Returns nothing.</P>
<P>Tells the object to construct its internal representation of the data by extracting
information from the given hash.</P>
<P>You would call <STRONG>as_HTML($q)</STRONG> later to retrieve a printable version of the data.</P>
<P>Each key in %$hash_ref is a unique positive integer, and points to a hash ref with these
sub keys:</P>
<UL>
<LI>
id - A unique positive integer, different for each node
<P>This is the identifier of this node. It is displayed with the constructor option
<STRONG>new</STRONG>(show_id =&gt; 1), which is the default.</P>
<P>Yes, this is a copy of the key within $hash_ref, for use within
Tree::Nary-dependent code.</P>
<P></P>
<LI>
name - A string
<P>This is the name of this node. It is displayed with the constructor option
<STRONG>new</STRONG>(show_name =&gt; 1), which is the default.</P>
<P></P>
<LI>
parent_id - An integer
<P>This is the identifier of the parent of this node.</P>
<P>The relationship between id and parent_id is what makes the data a tree.</P>
<P>0 means the node has no parent, ie this node is a child of a virtual root node.
By virtual, I mean each <CODE>CGI::Explorer</CODE> object creates its own root node, so that you
do not have to.</P>
<P>If you do have your own root node, with id 1 (say), then your root node's parent will
still be 0, and your next-level nodes will all have a parent id of 1.</P>
<P></P></UL>
<P>See ce.cgi for an example.</P>
<P>
<HR>
<H1><A NAME="get($option)"><CODE>get($option)</CODE></A></H1>
<P>Returns the current value of the given option, or undef if the option is unknown.</P>
<P>$tree -&gt; <CODE>get('css_background')</CODE> returns 'white', by default.</P>
<P>
<HR>
<H1><A NAME="image($icon_id, $new_image)">image($icon_id, $new_image)</A></H1>
<P>Returns the file name of the image for the given icon id.</P>
<P>Sets a new image file name for the given icon id.</P>
<P>See ce.cgi for an example.</P>
<P>The prefixes are:</P>
<UL>
<LI>
<PRE>
        'root' - The root icon</PRE>
<LI>
<PRE>
        '**' - The current icon</PRE>
<LI>
<PRE>
        '-L' - An open node with no siblings below it</PRE>
<LI>
<PRE>
        '--' - An open node with siblings below it</PRE>
<LI>
<PRE>
        '+L' - A closed node with no siblings below it</PRE>
<LI>
<PRE>
        '+-' - A closed node with siblings below it</PRE>
<LI>
<PRE>
        ' L' - A childless node with no siblings below it</PRE>
<LI>
<PRE>
        ' -' - A childless node with siblings below it</PRE>
<LI>
<PRE>
        '&amp;nbsp;&amp;nbsp;' - A horizontal spacer</PRE>
<LI>
<PRE>
        '| ' - A vertical connector</PRE>
</UL>
<P>Note: These are indented because of a bug in pod2html: It complains about '-L' when
that string is in column 1.</P>
<P>
<HR>
<H1><A NAME="name()"><CODE>name()</CODE></A></H1>
<P>Returns the name of the 'current' node.</P>
<P>
<HR>
<H1><A NAME="parent_id()"><CODE>parent_id()</CODE></A></H1>
<P>Returns the id of the parent of the 'current' node.</P>
<P>
<HR>
<H1><A NAME="set()"><CODE>set()</CODE></A></H1>
<P>Returns nothing.</P>
<P>Used to set a new value for any option, after a call to <STRONG>new()</STRONG>.</P>
<P><STRONG>set()</STRONG> takes the same parameters as <STRONG>new()</STRONG>.</P>
<P>
<HR>
<H1><A NAME="state($q)"><CODE>state($q)</CODE></A></H1>
<P>Returns the open/closed state of all nodes.</P>
<P>Tells the object to update its internal representation of the data by recovering
CGI form field data from the given CGI object.</P>
<P>Warning: This method can only be called after <STRONG>from_dir()</STRONG> or <STRONG>from_hash()</STRONG>.</P>
<P>Warning: You <STRONG>must</STRONG> use the return value as a field, presumably hidden, in a form,
in your script so that the value can do a round trip out to the browser and back.
This way the value can be recovered by the next invocation of your script.</P>
<P>This is the mechanism <CODE>CGI::Explorer</CODE> uses to maintain the open/closed state of each
node. State maintenance is a quite a complex issue. For details, see:</P>
<PRE>
        Writing Apache Modules with Perl and C
        Lincoln Stein and Doug MacEachern
        O'Reilly
        1-56592-567-X
        Chapter 5 'Maintaining State'</PRE>
<P>You can see the problem: When you close and then re-open a node, you expect all child
nodes to be restored to the open/close state they were in before the node was closed.</P>
<P>With a program like Windows Explorer, this is simple, since the program remains in
RAM, running, all the time nodes are being clicked. Thus it can maintain the state of
each node in its own (process) memory.</P>
<P>With a CGI script, 2 separate invocations of the script must maintain state outside
their own memory. I have chosen to use (hidden) form fields in <CODE>CGI::Explorer</CODE>.</P>
<P>See ce.cgi for an example.</P>
<P>The form fields have these names:</P>
<UL>
<LI>
<CODE>explorer_id_(\d+)</CODE> - The id of the node clicked on
<P>There is 1 such form field per node.</P>
<P>The click on this node, or the text of this node (when using click_text =&gt; 1), is
what submitted the form. (\d+) is a unique positive integer.</P>
<P>Your CGI script does not need to output these form fields. <STRONG>as_HTML($q)</STRONG> does this
for you.</P>
<P></P>
<LI>
explorer_state - The open/closed state of all nodes. Its value is a string
<P>Your CGI script must output this value.</P>
<P>See ce.cgi for an example.</P>
<P></P></UL>
<P>
<HR>
<H1><A NAME="required modules">Required Modules</A></H1>
<UL>
<LI>
Tree::Nary. Not shipped with Perl. Get it from a CPAN near you
<P></P></UL>
<P>
<HR>
<H1><A NAME="changes">Changes</A></H1>
<P>See Changes.txt.</P>
<P>
<HR>
<H1><A NAME="author">AUTHOR</A></H1>
<P><CODE>CGI::Explorer</CODE> was written by Ron Savage <EM>&lt;<A HREF="mailto:ron@savage.net.au">ron@savage.net.au</A>&gt;</EM> in 2001.</P>
<P>Home page: <A HREF="http://savage.net.au/index.html">http://savage.net.au/index.html</A></P>
<P>
<HR>
<H1><A NAME="copyright">COPYRIGHT</A></H1>
<P>Australian copyright (c) 2001, Ron Savage. All rights reserved.</P>
<PRE>
        All Programs of mine are 'OSI Certified Open Source Software';
        you can redistribute them and/or modify them under the terms of
        The Artistic License, a copy of which is available at:
        <A HREF="http://www.opensource.org/licenses/index.html">http://www.opensource.org/licenses/index.html</A></PRE>

</BODY>

</HTML>
